<?xml version="1.0" encoding="UTF-8" ?>

<project name="SDF" default="all">

	<!-- Key input modules -->
	<property name="sdfmodule" value="SDF" />
	<property name="esvmodule" value="SDF" />
	<property name="strmodule" value="sdf" />

	<!-- Project directories -->
	<property name="trans" location="trans" />
	<property name="src-gen" location="editor/java" />
	<property name="syntax" location="syntax" />
	<property name="include" location="include" />
	<property name="lib" location="lib" />
	<property name="build" location="bin" />
	<property name="dist" location="bin/dist" />
	<property name="sdf-src-gen" location="src-gen" />

	<!-- Imports -->
	<property name="build.sdf.imports" value="-Idef &quot;${basedir}/lib/SDF.def&quot;" />
	<property name="build.stratego.args" value="--library
                  -I &quot;${trans}&quot; -I &quot;${basedir}&quot;
                  -la strc -la stratego-lib -la stratego-sglr -la stratego-gpp -la stratego-xtc -la stratego-aterm
                  -la stratego-sdf" />

	<!-- External .def and .jar locations
	      <property name="externaldef" location="syntax/SDF.def"/>
        <property name="externaljar" value="../lib.jar"/>
        <property name="externaljarflags" value="-la org.lib"/>
        -->

	<!-- Environment configuration for command-line builds -->
	<condition property="build.strategoxt.sdf" value="${eclipse.spoofaximp.nativeprefix}" else="">
		<isset property="eclipse.spoofaximp.nativeprefix" />
	</condition>
	<property name="build.strategoxt.stratego" location="${user.home}/.nix-profile/bin" />

	<import file="build.generated.xml" />
	
	<!-- The files for which the on-save handler is called before building. -->
		<path id="call-onsave.files">
			<fileset dir=".">
				<include name="**/*.tmpl" />
				<include name="**/*.sdf3_" />
				<include name="**/*.nab" />
				<include name="**/*.ts" />
			</fileset>
		</path>

	<!-- Main target -->
	<target name="all" depends="spoofaximp.default.ctree" />
	
	<target name="clean" description="Clean project">
			<delete dir="${build}" />
			<delete dir="${sdf-src-gen}" />
			<delete dir=".cache" />
			<delete file="${include}/${sdfmodule}.def" />
			<delete file="${include}/${sdfmodule}-parenthesize.str" />
			<delete file="${include}/${sdfmodule}-Permissive.def" />
			<delete file="${include}/${sdfmodule}.generated.pp.af" />
			<delete file="${include}/${sdfmodule}.packed.esv" />
			<delete file="${include}/${sdfmodule}.pp.af" />
			<delete file="${include}/${sdfmodule}.rtg" />
			<delete file="${include}/${sdfmodule}.str" />
			<delete file="${include}/${sdfmodule}.tbl" />
			<delete file="${include}/${strmodule}.rtree" />
			<delete file="${include}/${strmodule}.ctree" />
			<delete file="${include}/${strmodule}.ctree.dep" />
			<delete file="${include}/${strmodule}.jar" />
			<delete>
				<fileset dir="editor" includes="*.generated.*" />
	      <fileset dir="trans" includes="*.pp.generated.str" />
			</delete>
			<delete dir="${src-gen}/trans" />
			<delete file="editor/${sdfmodule}.generated.esv" />
			<delete file="${syntax}/${sdfmodule}.generated.esv" />
			<delete file="${syntax}/${sdfmodule}.generated.pp" />
			<delete file="${include}/${metasdfmodule}-Permissive.def" />
			<delete file="${include}/${metasdfmodule}.def" />
			<delete file="${include}/${metasdfmodule}.tbl" />
			<delete file=".settings/org.eclipse.jdt.core.prefs" />
			<delete dir="utils" />
			<delete>
				<fileset dir="${lib}" includes="*.generated.str" />
			</delete>
			<antcall target="refresh-cleaned" />
		</target>


</project>

