<?xml version="1.0" encoding="UTF-8" ?>

<project name="TemplateLang" default="all">

	<!-- Key input modules -->
	<property name="sdfmodule" value="TemplateLang" />
	<property name="metasdfmodule" value="Stratego-TemplateLang" />
	<property name="esvmodule" value="TemplateLang" />
	<property name="strmodule" value="templatelang" />

	<!-- Project directories -->
	<property name="trans" location="trans" />
	<property name="src-gen" location="editor/java" />
	<property name="syntax" location="src-gen/syntax" />
	<property name="include" location="include" />
	<property name="lib" location="lib" />
	<property name="build" location="bin" />
	<property name="dist" location="bin/dist" />

	<!-- Imports -->
	<property name="build.sdf.imports" value="-Idef ${lib}/SDF.def" />
	<property name="build.stratego.args" value="
	      --library
	      -I &quot;${basedir}&quot;
	      -I &quot;${trans}&quot;
	      -la stratego-lib -la stratego-sglr -la stratego-gpp -la stratego-xtc -la stratego-aterm   
  	      -la stratego-sdf -la strc" />

	<!--property name="build.stratego.args" value="
      - -library
      -I &quot;${basedir}&quot;
      -I &quot;${trans}&quot;
      -la stratego-lib -la stratego-sglr -la stratego-gpp -la stratego-xtc -la stratego-aterm   
      -la stratego-sdf -la strc -la org.strategoxt.imp.editors.template.generated" /-->

	<!-- Optional: external .def and .jar locations
  <property name="externaldef" location="syntax/${sdfmodule}.def"/>
  <property name="externaljar" value="../lib.jar"/>
  <property name="externaljarflags" value="-la org.lib"/>
  -->

	<!-- Environment configuration for command-line builds -->
	<condition property="build.strategoxt.sdf" value="${eclipse.spoofaximp.nativeprefix}" else="">
		<isset property="eclipse.spoofaximp.nativeprefix" />
	</condition>
	<property name="build.strategoxt.stratego" location="${user.home}/.nix-profile/bin" />

	<import file="build.generated.xml" />

		<!-- The files for which the on-save handler is called before building. -->
		<path id="call-onsave.files">
			<fileset dir=".">
				<include name="**/*.tmpl" />
				<include name="**/*.sdf3" />
				<include name="**/*.nab" />
				<include name="**/*.ts" />
			</fileset>
		</path>
	
	<!-- Main target -->
	<target name="all" depends="pppack-esv, spoofaximp.default.jar" />


	<!-- Target to create EditorService-pretty.pp.af from EditorService-pretty.pp -->
	<available file="include/EditorService-pretty.pp.af" property="pppack-esv.available" />
	<target name="pppack-esv" unless="pppack-esv.available">
		<java classname="run" failonerror="true">
			<arg value="org.strategoxt.tools.main-parse-pp-table" />
			<arg value="-i" />
			<arg value="${lib}/EditorService-pretty.pp" />
			<arg value="-o" />
			<arg value="${include}/EditorService-pretty.pp.af" />
		</java>
	</target>

</project>
